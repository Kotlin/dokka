name: Build example projects and publish them to s3

on: push

env:
  branch-name: ${GITHUB_REF#refs/heads/}
  bucket-name: 'dokka-snapshots'

jobs:
  stdlib:
    runs-on: ubuntu-latest
    if: github.repository == 'Kotlin/dokka'
    steps:
      - name: Checkout dokka
        uses: actions/checkout@v3
        with:
          submodules: true
      - uses: actions/setup-java@v3
        with:
          distribution: 'zulu'
          java-version: 12
      - name: Document stdlib
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :integration-tests:gradle:integrationTest --tests org.jetbrains.dokka.it.gradle.kotlin.StdlibGradleIntegrationTest --stacktrace
      - name: Copy files to GitHub Actions Artifacts
        uses: actions/upload-artifact@v3
        with:
          name: dokka-stdlib
          path: ../stdlib

  serialization:
    runs-on: ubuntu-latest
    if: github.repository == 'Kotlin/dokka'
    steps:
      - name: Checkout dokka
        uses: actions/checkout@v3
        with:
          submodules: true
      - uses: actions/setup-java@v3
        with:
          distribution: 'zulu'
          java-version: 12
      - name: Document serialization
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :integration-tests:gradle:integrationTest --tests org.jetbrains.dokka.it.gradle.kotlin.SerializationGradleIntegrationTest --stacktrace
      - name: Copy files to GitHub Actions Artifacts
        uses: actions/upload-artifact@v3
        with:
          name: dokka-serialization
          path: ../serialization

  biojava:
    runs-on: ubuntu-latest
    if: github.repository == 'Kotlin/dokka'
    steps:
      - name: Checkout dokka
        uses: actions/checkout@v3
        with:
          submodules: true
      - uses: actions/setup-java@v3
        with:
          distribution: 'zulu'
          java-version: 12
      - name: Document biojava-core
        uses: gradle/gradle-build-action@v2
        with:
          arguments: :integration-tests:maven:integrationTest --tests org.jetbrains.dokka.it.maven.BiojavaIntegrationTest --stacktrace
      - name: Copy files to GitHub Actions Artifacts
        uses: actions/upload-artifact@v3
        with:
          name: dokka-biojava
          path: ../biojava
